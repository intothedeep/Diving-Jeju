<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.free.board.all.dao.AlbumDao">
    <insert id="storeFile" parameterType="albumDto">
        insert all
        into album (
            aseq, seq, 
            originalFileName, storedFileName, storedPath,
            thumbStoredFileName, thumbStoredPath,
            deleted, type, isPic, originalFileAseq
        )
        values(
            #{aseq}, #{seq}, 
            #{originalFileName}, #{storedFileName}, #{storedPath}, 
            #{thumbStoredFileName}, #{thumbStoredPath}, 
            #{deleted}, #{type}, #{isPic}, #{aseq}
        )
        into board (
            seq, id, name, email, bcode, logtime,
            content, subject
        )
        values (
            #{seq}, #{id}, #{name}, #{email}, #{bcode}, sysdate,
            '', '' 
        )
        select * from dual
    </insert>
    
    <select id="list" parameterType="int" resultType="albumDto">
        <![CDATA[
        select *
        from album a, board b
        where
            a.seq = b.seq and
            b.bcode = #{bcode} and
            deleted != 1
        order by originalFileAseq desc
        ]]>
    </select>
    
    <select id="getFileInfo" parameterType="int" resultType="albumDto">
        select *
        from album
        where aseq = #{aseq}
    </select>
    
    <update id="deleteUpdatedToOne" parameterType="int">
        update album
        set deleted = 1
        where aseq = #{aseq}
    </update>

</mapper>